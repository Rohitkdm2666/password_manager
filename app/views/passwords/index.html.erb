<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Manager</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center mb-4">
            <div class="col-lg-10">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-primary text-white">
                        <h2 style="display:flex; justify-content:center" class="mb-0">Add a New Password</h2>
                    </div>
                    <div class="card-body">
                        <%= form_with(model: @password, url: passwords_create_path, local: true, html: {class: "row g-3 align-items-center"}) do |form| %>
                            <%= form.hidden_field :user_id, value: @user_id %>
                            <div class="col-md-2">
                                <%= form.label :username, class: "form-label" %>
                                <%= form.text_field :username, class: "form-control", placeholder: "UserName" %>
                            </div>
                            <div class="col-md-2">
                                <%= form.label :password, class: "form-label" %>
                                <%= form.text_field :password, class: "form-control", placeholder: "Password" %>
                            </div>
                            <div class="col-md-3">
                                <%= form.label :website_url, class: "form-label" %>
                                <%= form.text_field :website_url, class: "form-control", placeholder: "https://example.com" %>
                            </div>
                            <div class="col-md-3">
                                <%= form.label :website_name, class: "form-label" %>
                                <%= form.text_field :website_name, class: "form-control", placeholder: "Website Name" %>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <%= form.submit "Save Password", class: "btn btn-primary w-100" %>
                            </div>
                        <% end %>
                        <div class="mt-3 text-center">
                            <%= link_to 'Back to Users', root_path, class: "btn btn-outline-secondary" %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">Saved Passwords</h3>
                        <span class="badge bg-info text-dark"><%= pluralize(@passwords.count, "Password") %></span>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover mb-0 align-middle">
                                <thead class="table-dark">
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">UserName</th>
                                        <th scope="col">Password</th>
                                        <th scope="col">Website URL</th>
                                        <th scope="col">Website Name</th>
                                        <th scope="col">Action</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <% @passwords.each_with_index do |password, index| %>
                                        <tr>
                                            <th scope="row"><%= index + 1 %></th>
                                            <td>
                                                <span class="badge bg-secondary fs-6"><%= password.username %></span>
                                            </td>
                                            <td style="width: 400px;">
                                                <!-- Password (hidden by default using type="password") -->
                                                <input type="password" id="password-<%= password.id %>" 
                                                        value="<%= password.password %>" 
                                                        class="form-control d-inline-block w-auto" readonly>

                                                <!-- Eye button -->
                                                <button type="button" class="btn btn-sm btn-outline-secondary"
                                                        onclick="togglePasswordVisibility(<%= password.id %>)">
                                                    üëÅ
                                                </button>
                                                <button style="border-width: 0;" onclick="copyToClipboard(<%= password.id %>)">    <i class="fa fa-copy" style="font-size:24px;"></i></button>
                                            </td>
                                            <td>
                                                <a href="<%= password.website_url %>" target="_blank" class="text-decoration-none">
                                                    <%= password.website_url %>
                                                </a>
                                            </td>
                                            <td><%= password.website_name %></td>
                                            <td>
                                            <%= button_to 'Delete', passwords_destroy_path(password), method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-sm btn-danger" %>

                                        </tr>
                                    <% end %>
                                    <% if @passwords.empty? %>
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">No passwords saved yet.</td>
                                        </tr>
                                    <% end %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS Bundle CDN (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    function copyToClipboard(id) {
        const text = document.getElementById("password-" + id).value;
        navigator.clipboard.writeText(text)
        
    }
    function togglePasswordVisibility(id) {
            const input = document.getElementById("password-" + id);
            if (input.type === "password") {
            input.type = "text";   // show password
            } else {
            input.type = "password"; // hide password
            }
        }
    </script>


</body>