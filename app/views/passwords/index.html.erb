<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Password Manager</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <style>
    body {
      background-color: #f8f9fa;
      font-family: "Segoe UI", sans-serif;
    }
    .card {
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    .card-header {
      font-weight: 600;
      font-size: 1.2rem;
    }
    .form-control {
      border-radius: 8px;
    }
    .btn {
      border-radius: 8px;
    }
    .btn-success {
      border-radius: 50%;
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    .table th {
      text-transform: uppercase;
      font-size: 0.9rem;
    }
    .badge {
      font-size: 0.95rem;
      padding: 0.4rem 0.7rem;
    }
    .empty-msg {
      font-style: italic;
      color: #6c757d;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <!-- Add new password -->
    <div class="row justify-content-center mb-5">
      <div class="col-lg-10">
        <div class="card border-0">
          <div class="card-header bg-primary text-white text-center">
            Add a New Password
          </div>
          <div class="card-body">
            <%= form_with(model: @password, url: passwords_create_path, local: true, html: { class: "row g-3 align-items-center" }) do |form| %>
              <%= form.hidden_field :user_id, value: @user_id %>

              <div class="col-md-2">
                <%= form.label :username, class: "form-label" %>
                <%= form.text_field :username, class: "form-control", placeholder: "UserName" %>
              </div>

              <div class="col-md-3 d-flex">
                <div class="flex-grow-1">
                  <%= form.label :password, class: "form-label" %>
                  <%= form.text_field :password, class: "form-control", placeholder: "Password" %>
                </div>
                <button type="button" onclick="generate()" class="btn btn-success ms-2 mt-auto">G</button>
              </div>

              <div class="col-md-3">
                <%= form.label :website_url, class: "form-label" %>
                <%= form.text_field :website_url, class: "form-control", placeholder: "https://example.com" %>
              </div>

              <div class="col-md-3">
                <%= form.label :website_name, class: "form-label" %>
                <%= form.text_field :website_name, class: "form-control", placeholder: "Website Name" %>
              </div>

              <div class="col-sm-1 d-flex align-items-end">
                <%= form.submit "Save", class: "btn btn-primary w-100" %>
              </div>
            <% end %>

            <div class="mt-3 text-center">
              <%= link_to 'Back to Users', root_path, class: "btn btn-outline-secondary" %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Saved passwords -->
    <div class="row justify-content-center">
      <div class="col-lg-12">
        <div class="card border-0">
          <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Saved Passwords</h5>
            <span class="badge bg-info text-dark"><%= pluralize(@passwords.count, "Password") %></span>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-striped table-hover mb-0 align-middle">
                <thead class="table-dark">
                  <tr>
                    <th>#</th>
                    <th>UserName</th>
                    <th>Password</th>
                    <th>Website URL</th>
                    <th>Website Name</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% @passwords.each_with_index do |password, index| %>
                    <tr>
                      <th><%= index + 1 %></th>
                      <td><span class="badge bg-secondary"><%= password.username %></span></td>

                      <td style="min-width: 280px;">
                        <input type="password" id="password-<%= password.id %>" 
                               value="<%= password.password %>" 
                               class="form-control d-inline-block w-auto" readonly>
                        <button type="button" onclick="togglePasswordVisibility(<%= password.id %>)" class="btn btn-sm btn-outline-secondary">üëÅ</button>
                        <button type="button" onclick="copyToClipboard(<%= password.id %>)" class="btn btn-sm btn-outline-secondary"><i class="fa fa-copy"></i></button>
                      </td>

                      <td>
                        <a href="<%= password.website_url %>" target="_blank" class="text-decoration-none">
                          <%= password.website_url %> <i class="fa fa-external-link"></i>
                        </a>
                      </td>

                      <td><%= password.website_name %></td>

                      <td style="height: 56px;" class="d-flex gap-2">
                        <%= link_to 'Update', passwords_edit_path(password), class: "btn btn-sm btn-secondary", style:"height:31px" %>
                        <%= button_to 'Delete', passwords_destroy_path(password), method: :delete, data: { confirm: 'Are you sure?' },style:"height:31px", class: "btn btn-sm btn-danger" %>
                      </td>
                    </tr>
                  <% end %>
                  <% if @passwords.empty? %>
                    <tr>
                      <td colspan="6" class="text-center py-4 empty-msg">No passwords saved yet.</td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function generate() {
      const length = 12;
      const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+~`|}{[]:;?><,./-=";
      let password = "";
      for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
      }
      document.querySelector('input[name="password[password]"]').value = password;
    }

    function copyToClipboard(id) {
      const text = document.getElementById("password-" + id).value;
      navigator.clipboard.writeText(text).then(() => {
        alert("Copied!");
      });
    }

    function togglePasswordVisibility(id) {
      const input = document.getElementById("password-" + id);
      input.type = input.type === "password" ? "text" : "password";
    }
  </script>
</body>
</html>
